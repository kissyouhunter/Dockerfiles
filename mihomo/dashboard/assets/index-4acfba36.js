import{j as e,c as w,f as et,r as h,p as je,e as Re,a as tt,b as V,d as ne,u as q,g as be,h as T,i as De,k as Me,l as _,R as Ae,m as st,n as ye,o as nt,q as oe,s as ot,t as He,v as ee,w as at,x as lt,y as ct,z as it,A as rt,B as Le,C as dt,D as ut,E as mt,F as ht,G as ft,$ as xt,H as pt,I as yt,N as gt,O as vt,J as wt,K as xe,L as jt,M as bt}from"./vendor-0606363c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();function J(){return navigator.userAgent==="ClashX Runtime"}let k=null;class Nt{constructor(t){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(n=>{this.instance=n,t()})}initBridge(t){if(!J())return t==null?void 0:t(null);if(window.WebViewJavascriptBridge!=null)return t(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];const n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout(()=>document.documentElement.removeChild(n),0)}async callHandler(t,n){return await new Promise(a=>{var o;(o=this.instance)==null||o.callHandler(t,n,a)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(t){return await this.callHandler("setPasteboard",t)}async writeConfigWithString(t){return await this.callHandler("writeConfigWithString",t)}async setSystemProxy(t){return await this.callHandler("setSystemProxy",t)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(t){return await this.callHandler("speedTest",t)}async setStartAtLogin(t){return await this.callHandler("setStartAtLogin",t)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function Ct(s){if(k!=null){s();return}k=new Nt(s)}function B(s){const{title:t,children:n,className:a,style:o}=s;return e.jsxs("header",{className:w("header",a),style:o,children:[e.jsx("h1",{className:"md:text-xl",children:t}),e.jsx("div",{className:"flex flex-auto items-center justify-end",children:n})]})}function $(s){const{type:t,size:n=14,className:a,style:o}=s,l=w("clash-iconfont",`icon-${t}`,a),c={fontSize:n,...o},r={...s,className:l,style:c};return e.jsx("i",{...r})}function I(){}function Pt(s,t){const n=[],a=[];for(const o of s)t(o)?n.push(o):a.push(o);return[n,a]}function z(s){const t=["B","KiB","MiB","GiB","TiB"],n=Math.floor(Math.log(s||1)/Math.log(1024));return`${et(s/Math.pow(1024,n),2).toFixed(2)} ${(t==null?void 0:t[n])??""}`}function ze(s){return s.replace(/.*[/\\]/,"")}function pe(s){const{className:t,checked:n=!1,disabled:a=!1,onChange:o=I}=s,l=w("switch",{checked:n,disabled:a},t);function c(){a||o(!n)}return e.jsx("div",{className:l,onClick:c,children:e.jsx($,{className:"switch-icon font-bold",type:"check",size:20})})}const O=h.forwardRef((s,t)=>{const{className:n,style:a,children:o}=s;return e.jsx("div",{className:w("card",n),style:a,ref:t,children:o})});function Te(s){const{options:t,value:n,onSelect:a}=s;return e.jsx("div",{className:"button-select",children:t.map(o=>e.jsx("button",{value:o.value,className:w("button-select-options",{actived:n===o.value}),onClick:()=>a==null?void 0:a(o.value),children:o.label},o.value))})}const St={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"中文",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version：{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret",addText:"Add",deleteText:"Delete",deleteErrorText:"Host not found"}},Logs:{title:"Logs",levelLabel:"Log level"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",type:"Type",chains:"Chains",process:"Process",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Up",download:"Down",network:"Network",process:"Process",processPath:"Path",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},kt={SideBar:{Proxies:"代理",Overview:"总览",Logs:"日志",Rules:"规则",Settings:"设置",Connections:"连接",Version:"版本"},Settings:{title:"设置",labels:{startAtLogin:"开机时启动",language:"语言",setAsSystemProxy:"设置为系统代理",allowConnectFromLan:"允许来自局域网的连接",proxyMode:"代理模式",socks5ProxyPort:"Socks5 代理端口",httpProxyPort:"HTTP 代理端口",mixedProxyPort:"混合代理端口",externalController:"外部控制设置"},values:{cn:"中文",en:"English",global:"全局",rules:"规则",direct:"直连",script:"脚本"},versionString:"当前 ClashX 已是最新版本：{{version}}",checkUpdate:"检查更新",externalControllerSetting:{title:"编辑外部控制设置",note:"请注意，修改该配置项并不会修改你的 Clash 配置文件，请确认修改后的外部控制地址和 Clash 配置文件内的地址一致，否则会导致 Dashboard 无法连接。",host:"Host",port:"端口",secret:"密钥",addText:"添 加",deleteText:"删 除",deleteErrorText:"没有找到该 Host"}},Logs:{title:"日志",levelLabel:"日志等级"},Rules:{title:"规则",providerTitle:"规则集",providerUpdateTime:"最后更新于",ruleCount:"规则条数"},Connections:{title:"连接",keepClosed:"保留关闭连接",total:{text:"总量",upload:"上传",download:"下载"},closeAll:{title:"警告",content:"将会关闭所有连接"},filter:{all:"全部"},columns:{host:"域名",network:"网络",process:"进程",type:"类型",chains:"节点链",rule:"规则",time:"连接时间",speed:"速率",upload:"上传",download:"下载",sourceIP:"来源 IP"},info:{title:"连接信息",id:"ID",host:"域名",hostEmpty:"空",dstIP:"IP",dstIPEmpty:"空",srcIP:"来源",upload:"上传",download:"下载",network:"网络",process:"进程",processPath:"路径",inbound:"入口",rule:"规则",chains:"代理",status:"状态",opening:"连接中",closed:"已关闭",closeConnection:"关闭连接"}},Proxies:{title:"代理",editDialog:{title:"编辑代理",color:"颜色",name:"名字",type:"类型",server:"服务器",port:"端口",password:"密码",cipher:"加密方式",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"策略组",providerTitle:"代理集",providerUpdateTime:"最后更新于",expandText:"展开",collapseText:"收起",speedTestText:"测速",breakConnectionsText:"切换时打断包含策略组的连接"},Modal:{ok:"确 定",cancel:"取 消"}},Oe={en_US:St,zh_CN:kt},Et=Object.keys(Oe);function Lt(){for(const s of window.navigator.languages){if(s.includes("zh"))return"zh_CN";if(s.includes("us"))return"en_US"}return"en_US"}function Ne(s){return h.useMemo(()=>{function n(a,o){if(typeof a=="string")s(l=>{const c=a,r=o;l[c]=r});else if(typeof a=="function"){const l=a;s(c=>l(c))}else typeof a=="object"&&s(l=>je(l,c=>{const r=a;for(const d of Object.keys(r)){const m=d;c[m]=r[m]}}))}return n},[s])}class Ue{constructor(t){this.EE=new Re,this.innerBuffer=[],this.url="",this.connection=null,this.config=Object.assign({bufferLength:0,retryInterval:5e3},t)}connectWebsocket(){if(!this.url)return;const t=new URL(this.url);this.connection=new WebSocket(t.toString()),this.connection.addEventListener("message",n=>{const a=JSON.parse(n.data);this.EE.emit("data",[a]),this.config.bufferLength>0&&(this.innerBuffer.push(a),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),this.connection.addEventListener("error",n=>{var a;this.EE.emit("error",n),(a=this.connection)==null||a.close(),setTimeout(this.connectWebsocket,this.config.retryInterval)})}connect(t){var n;this.url===t&&this.connection||(this.url=t,(n=this.connection)==null||n.close(),this.connectWebsocket())}subscribe(t,n){this.EE.addListener(t,n)}unsubscribe(t,n){this.EE.removeListener(t,n)}buffer(){return this.innerBuffer.slice()}destory(){var t;this.EE.removeAllListeners(),(t=this.connection)==null||t.close(),this.connection=null}}class Tt{constructor(t,n){this.axiosClient=tt.create({baseURL:t,headers:n?{Authorization:`Bearer ${n}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(t){return await this.axiosClient.patch("configs",t)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const t=await this.axiosClient.get("providers/proxies",{validateStatus(n){return n>=200&&n<300||n===404}});return t.status===404&&(t.data={providers:{}}),t}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(t){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(t)}`)}async updateRuleProvider(t){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(t)}`)}async healthCheckProvider(t){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(t)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(t){return await this.axiosClient.delete(`connections/${t}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(t,n){return await this.axiosClient.put(`proxies/${encodeURIComponent(t)}`,{name:n})}}const $t=V(async()=>{if(!J())return null;const s=await k.getAPIInfo();return{hostname:s.host,port:s.port,secret:s.secret,protocol:"http:"}}),It='[{ "hostname": "127.0.0.1", "port": 9090, "secret": "" }]',Rt="0",Ce=ne("externalControllers",JSON.parse(It)),Pe=ne("externalControllerIndex",parseInt(Rt));function Q(){var f,g,y,u;const s=q($t),t=be(),n=q(Pe),a=q(Ce);if(s!=null)return s;let o;{const x=document.querySelector('meta[name="external-controller"]');((f=x==null?void 0:x.content)==null?void 0:f.match(/^https?:/))!=null&&(o=new URL(x.content))}const l=new URLSearchParams(t.search),c=l.get("host")??((g=a==null?void 0:a[n])==null?void 0:g.hostname)??(o==null?void 0:o.hostname)??"127.0.0.1",r=l.get("port")??((y=a==null?void 0:a[n])==null?void 0:y.port)??(o==null?void 0:o.port)??"9090",d=l.get("secret")??((u=a==null?void 0:a[n])==null?void 0:u.secret)??(o==null?void 0:o.username)??"",m=l.get("protocol")??c==="127.0.0.1"?"http:":(o==null?void 0:o.protocol)??window.location.protocol;return{hostname:c,port:r,secret:d,protocol:m}}const Dt=V({key:"",instance:null});function R(){const{secret:s}=Q(),[t,n]=T(Dt),a=`/api?secret=${s}`;if(t.key===a)return t.instance;const o=new Tt("/api",s);return n({key:a,instance:o}),o}const Se=V(!0),Mt=ne("language",void 0);function E(){const[s,t]=T(Mt),n=h.useMemo(()=>s??Lt(),[s]),a=h.useCallback(function(o){function l(c){return nt(Oe[n][o],c)}return{t:l}},[n]);return{lang:n,locales:Et,setLang:t,translation:a}}const Be=V({version:"",premium:!1});function Fe(){const[s,t]=T(Be),n=R(),a=Me(Se);return _([n],async function(){const o=await Ae.fromPromise(n.getVersion(),l=>l);a(o.isOk()),t(o.isErr()?{version:"",premium:!1}:{version:o.value.data.version,premium:!!o.value.data.premium})}),s}function Ve(){const[{premium:s}]=T(Be),t=R(),{data:n,mutate:a}=_(["/providers/rule",t,s],async()=>{if(!s)return[];const o=await t.getRuleProviders();return Object.keys(o.data.providers).map(l=>o.data.providers[l])});return{providers:n??[],update:a}}const At=ne("profile",{breakConnections:!1,logLevel:""});function ae(){const[s,t]=T(At),n=h.useCallback(a=>{t(je(s,a))},[s,t]);return{data:s,set:Ne(n)}}const _e=V([]);function We(){const[s,t]=T(_e),n=R(),{data:a,mutate:o}=_(["/providers/proxy",n],async()=>{const l=await n.getProxyProviders();return Object.keys(l.data.providers).map(c=>l.data.providers[c]).filter(c=>c.name!=="default").filter(c=>c.vehicleType!=="Compatible")});return h.useEffect(()=>{t(a??[])},[a,t]),{providers:s,update:o}}function le(){const s=R(),{data:t,mutate:n}=_(["/config",s],async()=>{const o=(await s.getConfig()).data;return{port:o.port,socksPort:o["socks-port"],mixedPort:o["mixed-port"]??0,redirPort:o["redir-port"],mode:o.mode.toLowerCase(),logLevel:o["log-level"],allowLan:o["allow-lan"]}});return{general:t??{},update:n}}const Ge=De({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function ce(){const[s,t]=T(Ge),n=Ne(t),a=R(),{mutate:o}=_(["/proxies",a],async()=>{const c=await a.getProxies(),r=c.data.proxies.GLOBAL;r.name="GLOBAL";const d=new Set(["Selector","URLTest","Fallback","LoadBalance"]),m=new Set(["DIRECT","REJECT","GLOBAL"]),f=r.all.filter(u=>!m.has(u)).map(u=>({...c.data.proxies[u],name:u})),[g,y]=Pt(f,u=>!d.has(u.type));n({proxies:g,groups:y,global:r})}),l=h.useCallback((c,r)=>{n(d=>{c==="GLOBAL"&&(d.global.now=r);for(const m of d.groups)m.name===c&&(m.now=r)})},[n]);return{proxies:s.proxies,groups:s.groups,global:s.global,update:o,markProxySelected:l,set:n}}const Ht=V(s=>{const t=s(Ge),n=s(_e),a=new Map;for(const o of t.proxies)a.set(o.name,o);for(const o of n)for(const l of o.proxies)a.set(l.name,l);return a});function Je(){const{data:s,mutate:t}=_("/clashx",async()=>{if(!J())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const n=await(k==null?void 0:k.getStartAtLogin())??!1,a=await(k==null?void 0:k.isSystemProxySet())??!1;return{startAtLogin:n,systemProxy:a,isClashX:!0}});return{data:s,update:t}}const zt=De([]);function Ot(){const[s,t]=T(zt),n=Ne(t),a=R();async function o(){const l=await a.getRules();n(l.data.rules)}return{rules:s,update:o}}const Ut=V(new Ue({bufferLength:200}));function Xe(){const s=Q(),{general:t}=le(),{data:{logLevel:n}}=ae(),a=q(Ut),o=n||t.logLevel,l=st(`${s.protocol}//${s.hostname}:${s.port}/logs?level=${o}&secret=${encodeURIComponent(s.secret)}`),c=ye(s);return h.useEffect(()=>{if(o){const r=c.current,m=`${r.protocol==="http:"?"ws:":"wss:"}//${window.location.host}/api/logs?level=${o}&token=${encodeURIComponent(r.secret)}`;a.connect(m)}},[c,a,o,l]),a}function Bt(){const s=Q(),t=h.useRef(new Ue({bufferLength:200})),a=`${s.protocol==="http:"?"ws:":"wss:"}//${window.location.host}/api/connections?token=${encodeURIComponent(s.secret)}`;return h.useEffect(()=>{t.current.connect(a)},[a]),t.current}function Ft(s){const{className:t,data:n,onClick:a,select:o,canClick:l,errSet:c,rowHeight:r}=s,{translation:d}=E(),{t:m}=d("Proxies"),[f,g]=h.useState(!1),[y,u]=h.useState(!1),x=h.useRef(null);h.useLayoutEffect(()=>{var b;u((((b=x==null?void 0:x.current)==null?void 0:b.offsetHeight)??0)>30)},[]);const P=f?"auto":r,p=l?a:I;function N(){g(!f)}const S=n.map(b=>{const L=w({"tags-selected":o===b,"cursor-pointer":l,error:c==null?void 0:c.has(b)});return e.jsx("li",{className:L,onClick:()=>p(b),children:b},b)});return e.jsxs("div",{className:w("flex items-start overflow-y-hidden",t),style:{height:P},children:[e.jsx("ul",{ref:x,className:w("tags",{expand:f}),children:S}),y&&e.jsx("span",{className:"h-7 cursor-pointer select-none px-5 leading-7",onClick:N,children:m(f?"collapseText":"expandText")})]})}function G(s){const{className:t,style:n,value:a="",align:o="center",inside:l=!1,autoFocus:c=!1,type:r="text",disabled:d=!1,onChange:m=I,onBlur:f=I,onEnter:g=I}=s,y=w("input",`text-${o}`,{"focus:shadow-none":l},t);function u(x){x.code==="Enter"&&g(x)}return e.jsx("input",{disabled:d,className:y,style:n,value:a,autoFocus:c,type:r,onChange:x=>m(x.target.value,x),onBlur:f,onKeyDown:u})}function Ye(s){const{value:t,options:n,onSelect:a,disabled:o,className:l,style:c}=s,r=h.useRef(document.createElement("div")),d=h.useRef(null),[m,f]=h.useState(!1),[g,y]=h.useState({});h.useLayoutEffect(()=>{const p=r.current;return document.body.appendChild(p),()=>{document.body.removeChild(p)}},[]);function u(){if(!o){if(!m){const p=d.current.getBoundingClientRect();y({top:Math.floor(p.top+p.height)+6,left:Math.floor(p.left)-10})}f(!m)}}const x=h.useMemo(()=>n.find(p=>p.value===t),[t,n]),P=e.jsx("div",{className:w("select-list",{"select-list-show":m}),style:g,children:e.jsx("ul",{className:"list",children:n.map(p=>e.jsx(Vt,{className:w({selected:p.value===t}),onClick:N=>{a==null||a(p.value,N),f(!1)},disabled:p.disabled,value:p.value,children:p.label},p.key??p.value))})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:w("select",{disabled:o},l),style:c,ref:d,onClick:u,children:[e.jsx("span",{className:"select-none",children:x==null?void 0:x.label}),e.jsx($,{type:"triangle-down"})]}),oe.createPortal(P,r.current)]})}function Vt(s){const{className:t,style:n,disabled:a=!1,children:o,onClick:l=I}=s,c=w("option",{disabled:a},t);return e.jsx("li",{className:c,style:n,onClick:l,children:o})}function qe(s){const{show:t=!0,title:n="Modal",size:a="small",footer:o=!0,onOk:l=I,onClose:c=I,bodyClassName:r,bodyStyle:d,className:m,footerExtra:f,style:g,children:y}=s,{translation:u}=E(),{t:x}=u("Modal"),P=h.useRef(document.createElement("div")),p=h.useRef(null);h.useLayoutEffect(()=>{const b=P.current;return document.body.appendChild(b),()=>{document.body.removeChild(b)}},[]);function N(b){b.target===p.current&&c()}const S=e.jsx("div",{className:w("modal-mask",{"modal-show":t}),ref:p,onMouseDown:N,children:e.jsxs("div",{className:w("modal",`modal-${a}`,m),style:g,children:[e.jsx("div",{className:"modal-title",children:n}),e.jsx("div",{className:w("modal-body",r),style:d,children:y}),o&&e.jsxs("div",{className:"flex items-center justify-between",children:[f,e.jsxs("div",{className:"flex flex-1 justify-end space-x-3",children:[e.jsx(K,{onClick:()=>c(),children:x("cancel")}),e.jsx(K,{type:"primary",onClick:()=>l(),children:x("ok")})]})]})]})});return oe.createPortal(S,P.current)}const _t={success:"check",info:"info",warning:"info",error:"close"};function Wt(s){const{message:t="",type:n="info",inside:a=!1,children:o,className:l,style:c}=s,r=w("alert",`alert-${a?"note":"box"}-${n}`,l);return e.jsxs("div",{className:r,style:c,children:[e.jsx("span",{className:"alert-icon",children:e.jsx($,{type:_t[n],size:26})}),t?e.jsx("p",{className:"alert-message",children:t}):e.jsx("div",{className:"alert-message",children:o})]})}function K(s){const{type:t="normal",onClick:n=I,children:a,className:o,style:l,disabled:c}=s,r=w("button",`button-${t}`,o,{"button-disabled":c});return e.jsx("button",{className:r,style:l,onClick:n,disabled:c,children:a})}function te(s){const[t,n]=ot(s),a=h.useMemo(()=>{function o(l,c){typeof l=="string"?n(r=>{const d=l,m=c;r[d]=m}):typeof l=="function"?n(l):typeof l=="object"&&n(r=>{const d=l;for(const m of Object.keys(d)){const f=m;r[f]=d[f]}})}return o},[n]);return[t,a]}function Gt(s,t=0){if(s.length<2)throw new Error("List requires at least two elements");const[n,a]=h.useState(t);function o(){a((n+1)%s.length)}return{current:h.useMemo(()=>s[n],[s,n]),next:o}}function ie(s=!1){const[t,n]=h.useState(s);function a(){n(!1)}function o(){n(!0)}return{visible:t,hide:a,show:o}}const Jt={info:"info",success:"check",warning:"info-o",error:"close"};function Xt(s){const{removeComponent:t=I,onClose:n=I,icon:a=e.jsx($,{type:"info",size:16}),content:o="",type:l="info",duration:c=1500}=s,{visible:r,show:d,hide:m}=ie();return h.useLayoutEffect(()=>{window.setTimeout(()=>d(),0);const f=window.setTimeout(()=>{m(),n()},c);return()=>window.clearTimeout(f)},[c,m,n,d]),e.jsxs("div",{className:w("message",`message-${l}`,{"message-show":r}),onTransitionEnd:()=>!r&&t(),children:[e.jsx("span",{className:"message-icon",children:a}),e.jsx("span",{className:"message-content",children:o})]})}function Yt(s){const t=document.createElement("div");document.body.appendChild(t);const n=()=>{oe.unmountComponentAtNode(t)&&document.body.removeChild(t)},a=e.jsx($,{type:Jt[s.type],size:16}),{type:o,content:l,duration:c,onClose:r}=s,d={icon:a,type:o,content:l,removeComponent:n,duration:c,onClose:r};He(t).render(e.jsx(Xt,{...d}))}const qt=(s,t,n)=>Yt({type:"error",content:s,duration:t,onClose:n});function Ke(s){const{className:t,checked:n=!1,onChange:a=I}=s,o=w("checkbox",{checked:n},t);function l(){a(!n)}return e.jsxs("div",{className:o,onClick:l,children:[e.jsx($,{className:"checkbox-icon",type:"check",size:18}),e.jsx("div",{children:s.children})]})}function se(s){const{color:t,className:n,style:a}=s,o=w("tag",n),l={color:t,...a},c={...s,className:o,style:l};return e.jsx("span",{...c,children:s.children})}function Kt(s){const t=w("spinner",s.className);return e.jsxs("div",{className:t,children:[e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})})]})}function Qe(s){const t=w("loading","visible",s.className);return s.visible?e.jsx("div",{className:t,children:e.jsx(Kt,{className:s.spinnerClassName})}):null}function Qt(s){var o;const t=h.useRef(document.createElement("div"));h.useLayoutEffect(()=>{const l=t.current;return document.body.appendChild(l),()=>{document.body.removeChild(l)}},[]);const n="absolute h-full right-0 transition-transform transform duration-100 pointer-events-auto",a=e.jsx("div",{className:w(s.className,"z-9999 pointer-events-none absolute inset-0"),children:e.jsx(O,{className:w(n,s.bodyClassName,{"translate-x-0":s.visible,"translate-x-full":!s.visible}),style:{width:s.width??400},children:s.children})});return oe.createPortal(a,((o=s.containerRef)==null?void 0:o.current)??t.current)}ee.extend(at);function ke(s,t){const n=t==="en_US"?"en":"zh-cn";return ee(s).locale(n).from(ee())}function Zt(s){const{translation:t}=E(),n=h.useMemo(()=>t("Connections").t,[t]),{className:a,style:o}=s,l=w("flex flex-wrap px-1",a);function c(r){var d;(d=s.onChange)==null||d.call(s,r)}return e.jsxs("div",{className:l,style:o,children:[e.jsx("div",{className:w("connections-devices-item mb-2 pt-2",{selected:s.selected===""}),onClick:()=>c(""),children:n("filter.all")}),s.devices.map(r=>e.jsxs("div",{className:w("connections-devices-item mb-2 pt-2",{selected:s.selected===r.label}),onClick:()=>c(r.label),children:[r.label," (",r.number,")"]},r.label))]})}function es(s){var a,o,l,c,r,d,m,f,g,y,u;const{translation:t}=E(),n=h.useMemo(()=>t("Connections").t,[t]);return e.jsxs("div",{className:w(s.className,"flex flex-col overflow-y-auto text-sm"),children:[e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.id")}),e.jsx("span",{className:"font-mono",children:s.connection.id})]}),e.jsxs("div",{className:"my-3 flex justify-between",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.network")}),e.jsx("span",{className:"font-mono",children:(a=s.connection.metadata)==null?void 0:a.network})]}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.inbound")}),e.jsx("span",{className:"font-mono",children:(o=s.connection.metadata)==null?void 0:o.type})]})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.host")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(l=s.connection.metadata)!=null&&l.host?`${s.connection.metadata.host}:${(c=s.connection.metadata)==null?void 0:c.destinationPort}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.dstIP")}),e.jsx("span",{className:"font-mono",children:(r=s.connection.metadata)!=null&&r.destinationIP?`${s.connection.metadata.destinationIP}:${(d=s.connection.metadata)==null?void 0:d.destinationPort}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.srcIP")}),e.jsx("span",{className:"font-mono",children:`${(m=s.connection.metadata)==null?void 0:m.sourceIP}:${(f=s.connection.metadata)==null?void 0:f.sourcePort}`})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.process")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(g=s.connection.metadata)!=null&&g.processPath?`${ze(s.connection.metadata.processPath)}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.processPath")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(y=s.connection.metadata)!=null&&y.processPath?`${s.connection.metadata.processPath}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.rule")}),e.jsx("span",{className:"font-mono",children:s.connection.rule&&`${s.connection.rule}${s.connection.rulePayload&&` :: ${s.connection.rulePayload}`}`})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.chains")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(u=s.connection.chains)==null?void 0:u.slice().reverse().join(" / ")})]}),e.jsxs("div",{className:"my-3 flex justify-between",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.upload")}),e.jsx("span",{className:"font-mono",children:z(s.connection.upload??0)})]}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.download")}),e.jsx("span",{className:"font-mono",children:z(s.connection.download??0)})]})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.status")}),e.jsx("span",{className:"font-mono",children:s.connection.completed?e.jsx("span",{className:"text-red",children:n("info.closed")}):e.jsx("span",{className:"text-green",children:n("info.opening")})})]})]})}class ts{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(t){var a;const n=t.reduce((o,l)=>o.set(l.id,l),new Map);for(const o of this.connections.keys())if(!n.has(o))if(!this.saveDisconnection)this.connections.delete(o);else{const l=this.connections.get(o);l!=null&&this.connections.set(o,je(l,c=>{c.completed=!0,c.uploadSpeed=0,c.downloadSpeed=0}))}for(const o of n.keys()){if(!this.connections.has(o)){this.connections.set(o,{...n.get(o),uploadSpeed:0,downloadSpeed:0});continue}const l=this.connections.get(o),c=n.get(o);(a=this.connections)==null||a.set(o,{...c,uploadSpeed:c.upload-l.upload,downloadSpeed:c.download-l.download})}}toggleSave(){var t,n;if(this.saveDisconnection){this.saveDisconnection=!1;for(const a of this.connections.keys())(n=(t=this.connections)==null?void 0:t.get(a))!=null&&n.completed&&this.connections.delete(a)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function ss(){const s=h.useMemo(()=>new ts,[]),t=h.useRef(!0),[n,a]=h.useState([]),[o,l]=h.useState(!1),c=h.useCallback(function(d){s.appendToSet(d),t.current&&a(s.getConnections()),t.current=!t.current},[s]),r=h.useCallback(function(){const d=s.toggleSave();l(d),d||a(s.getConnections()),t.current=!0},[s]);return{connections:n,feed:c,toggleSave:r,save:o}}const j={Host:"host",Network:"network",Process:"process",Type:"type",Chains:"chains",Rule:"rule",Speed:"speed",Upload:"upload",Download:"download",SourceIP:"sourceIP",Time:"time"},ns=new Set([j.Network,j.Type,j.Speed,j.Upload,j.Download,j.SourceIP,j.Time,j.Process]);function os(s,t){switch(!0){case(s===0&&t===0):return"-";case(s!==0&&t!==0):return`↑ ${z(s)}/s ↓ ${z(t)}/s`;case s!==0:return`↑ ${z(s)}/s`;default:return`↓ ${z(t)}/s`}}const M=dt();function as(){const{translation:s,lang:t}=E(),n=h.useMemo(()=>s("Connections").t,[s]),a=Bt(),o=ye(a),l=R(),c=h.useRef(null),[r,d]=te({uploadTotal:0,downloadTotal:0}),{visible:m,show:f,hide:g}=ie();function y(){l.closeAllConnections().finally(()=>g())}const{connections:u,feed:x,save:P,toggleSave:p}=ss(),N=h.useMemo(()=>u.map(i=>({id:i.id,host:`${i.metadata.host||i.metadata.destinationIP}:${i.metadata.destinationPort}`,chains:i.chains.slice().reverse().join(" / "),rule:i.rulePayload?`${i.rule} :: ${i.rulePayload}`:i.rule,time:new Date(i.start).getTime(),upload:i.upload,download:i.download,sourceIP:i.metadata.sourceIP,type:i.metadata.type,network:i.metadata.network.toUpperCase(),process:i.metadata.processPath,speed:{upload:i.uploadSpeed,download:i.downloadSpeed},completed:!!i.completed,original:i})),[u]),S=h.useMemo(()=>{const i=lt(u,"metadata.sourceIP");return Object.keys(i).map(C=>({label:C,number:i[C].length})).sort((C,v)=>C.label.localeCompare(v.label))},[u]),b=h.useRef(null),L=ct(b,{threshold:[1]}),W=h.useMemo(()=>[M.accessor(j.Host,{minSize:260,size:260,header:n(`columns.${j.Host}`)}),M.accessor(j.Network,{minSize:80,size:80,header:n(`columns.${j.Network}`)}),M.accessor(j.Type,{minSize:100,size:100,header:n(`columns.${j.Type}`)}),M.accessor(j.Chains,{minSize:200,size:200,header:n(`columns.${j.Chains}`)}),M.accessor(j.Rule,{minSize:140,size:140,header:n(`columns.${j.Rule}`)}),M.accessor(j.Process,{minSize:100,size:100,header:n(`columns.${j.Process}`),cell:i=>i.getValue()?ze(i.getValue()):"-"}),M.accessor(i=>[i.speed.upload,i.speed.download],{id:j.Speed,header:n(`columns.${j.Speed}`),minSize:200,size:200,sortDescFirst:!0,sortingFn(i,C){var Y,Ee;const v=((Y=i.original)==null?void 0:Y.speed)??{upload:0,download:0},H=((Ee=C.original)==null?void 0:Ee.speed)??{upload:0,download:0};return v.download===H.download?v.upload-H.upload:v.download-H.download},cell:i=>os(i.getValue()[0],i.getValue()[1])}),M.accessor(j.Upload,{minSize:100,size:100,header:n(`columns.${j.Upload}`),cell:i=>z(i.getValue())}),M.accessor(j.Download,{minSize:100,size:100,header:n(`columns.${j.Download}`),cell:i=>z(i.getValue())}),M.accessor(j.SourceIP,{minSize:140,size:140,header:n(`columns.${j.SourceIP}`),filterFn:"equals"}),M.accessor(j.Time,{minSize:120,size:120,header:n(`columns.${j.Time}`),cell:i=>ke(new Date(i.getValue()),t),sortingFn:(i,C)=>{var v,H;return(((v=C.original)==null?void 0:v.time)??0)-(((H=i.original)==null?void 0:H.time)??0)}})],[t,n]);h.useLayoutEffect(()=>{function i(C){for(const v of C)d({uploadTotal:v.uploadTotal,downloadTotal:v.downloadTotal}),x(v.connections)}return a==null||a.subscribe("data",i),()=>{a==null||a.unsubscribe("data",i)}},[a,x,d]),it(()=>{var i;(i=o.current)==null||i.destory()});const X=rt({data:N,columns:W,getCoreRowModel:ut(),getSortedRowModel:mt(),getFilteredRowModel:ht(),initialState:{sorting:[{id:j.Time,desc:!1}]},columnResizeMode:"onChange",enableColumnResizing:!0}),Z=X.getHeaderGroups()[0],[re,de]=h.useState("");function ue(i){var C;de(i),(C=X.getColumn(j.SourceIP))==null||C.setFilterValue(i||void 0)}const[A,U]=te({visible:!1,selectedID:"",connection:{}});function me(){U(i=>{i.connection.completed=!0}),l.closeConnection(A.selectedID)}const F=ye(A.connection);h.useEffect(()=>{var C;const i=(C=N.find(v=>v.id===A.selectedID))==null?void 0:C.original;i?U(v=>{v.connection={...i},A.selectedID===F.current.id&&(v.connection.completed=F.current.completed)}):Object.keys(F.current).length!==0&&!F.current.completed&&U(v=>{v.connection.completed=!0})},[N,A.selectedID,F,U]);const D=h.useMemo(()=>((L==null?void 0:L.intersectionRatio)??0)<1,[L]),he=Z.headers.map((i,C)=>{const v=i.column,H=v.id;return e.jsxs("th",{className:w("connections-th",{resizing:v.getIsResizing(),fixed:v.id===j.Host,shadow:D&&v.id===j.Host}),style:{width:i.getSize()},ref:v.id===j.Host?b:void 0,children:[e.jsxs("div",{onClick:v.getToggleSortingHandler(),children:[Le(i.column.columnDef.header,i.getContext()),v.getIsSorted()!==!1?v.getIsSorted()==="desc"?" ↓":" ↑":null]}),C!==Z.headers.length-1&&e.jsx("div",{onMouseDown:i.getResizeHandler(),onTouchStart:i.getResizeHandler(),className:"connections-resizer"})]},H)}),fe=X.getRowModel().rows.map(i=>{var C;return e.jsx("tr",{className:"cursor-default select-none",onClick:()=>{var v;return U({visible:!0,selectedID:(v=i.original)==null?void 0:v.id})},children:i.getAllCells().map(v=>{var Y;const H=w("connections-block",{"text-center":ns.has(v.column.id),completed:(Y=i.original)==null?void 0:Y.completed},{fixed:v.column.id===j.Host,shadow:D&&v.column.id===j.Host});return e.jsx("td",{className:H,style:{width:v.column.getSize()},children:Le(v.column.columnDef.cell,v.getContext())},v.column.id)})},(C=i.original)==null?void 0:C.id)});return e.jsxs("div",{className:"page !h-100vh",children:[e.jsxs(B,{title:n("title"),children:[e.jsx("span",{className:"connections-filter flex-1 cursor-default",children:`(${n("total.text")}: ${n("total.upload")} ${z(r.uploadTotal)} ${n("total.download")} ${z(r.downloadTotal)})`}),e.jsx(Ke,{className:"connections-filter",checked:P,onChange:p,children:n("keepClosed")}),e.jsx($,{className:"connections-filter dangerous",onClick:f,type:"close-all",size:20})]}),S.length>1&&e.jsx(Zt,{devices:S,selected:re,onChange:ue}),e.jsx(O,{ref:c,className:"connections-card relative",children:e.jsx("div",{className:"min-h-full min-w-full overflow-auto",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{className:"connections-header",children:he})}),e.jsx("tbody",{children:fe})]})})}),e.jsx(qe,{title:n("closeAll.title"),show:m,onClose:g,onOk:y,children:n("closeAll.content")}),e.jsxs(Qt,{containerRef:c,bodyClassName:"flex flex-col",visible:A.visible,width:450,children:[e.jsxs("div",{className:"h-8 flex items-center justify-between",children:[e.jsx("span",{className:"pl-3 font-bold",children:n("info.title")}),e.jsx($,{type:"close",size:16,className:"cursor-pointer",onClick:()=>U("visible",!1)})]}),e.jsx(es,{className:"mt-3 px-5",connection:A.connection}),e.jsx("div",{className:"mt-3 flex justify-end pr-3",children:e.jsx(K,{type:"danger",disabled:A.connection.completed,onClick:()=>me(),children:n("info.closeConnection")})})]})]})}function ls(){const{translation:s}=E(),{t}=s("Settings"),{hostname:n,port:a,secret:o}=Q(),[l,c]=T(Se),[r,d]=te({hostname:"",port:"",secret:""});h.useEffect(()=>{d({hostname:n,port:a,secret:o})},[n,a,o,d]);const[m,f]=T(Ce),[g,y]=T(Pe);function u(){const{hostname:N,port:S,secret:b}=r;f([{hostname:N,port:S,secret:b}])}function x(){const{hostname:N,port:S,secret:b}=r,L=[...m,{hostname:N,port:S,secret:b}];f(L),y(L.length-1)}function P(){const{hostname:N,port:S}=r,b=m.findIndex(W=>W.hostname===N&&W.port===S);if(b===-1){qt(t("externalControllerSetting.deleteErrorText"));return}const L=[...m.slice(0,b),...m.slice(b+1)];f(L),g>=b&&y(0)}const p=e.jsxs("div",{className:"space-x-3",children:[e.jsx(K,{type:"primary",onClick:()=>x(),children:t("externalControllerSetting.addText")}),e.jsx(K,{type:"danger",disabled:m.length<2,onClick:()=>P(),children:t("externalControllerSetting.deleteText")})]});return e.jsxs(qe,{className:"!w-105 !<sm:w-84",show:!l,title:t("externalControllerSetting.title"),bodyClassName:"external-controller",footerExtra:p,onClose:()=>c(!0),onOk:u,children:[e.jsx(Wt,{type:"info",inside:!0,children:e.jsx("p",{children:t("externalControllerSetting.note")})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"my-1 w-14 font-bold md:my-3",children:t("externalControllerSetting.host")}),e.jsx(G,{className:"my-1 flex-1 md:my-3",align:"left",inside:!0,value:r.hostname,onChange:N=>d("hostname",N),onEnter:u})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"my-1 w-14 font-bold md:my-3",children:t("externalControllerSetting.port")}),e.jsx(G,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:r.port,onChange:N=>d("port",N),onEnter:u})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"my-1 w-14 font-bold md:my-3",children:t("externalControllerSetting.secret")}),e.jsx(G,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:r.secret,onChange:N=>d("secret",N),onEnter:u})]})]})}const cs=[{label:"Default",value:""},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warning"},{label:"Error",value:"error"},{label:"Silent",value:"silent"}],is=new Map([["debug","text-teal-500"],["info","text-sky-500"],["warning","text-pink-500"],["error","text-rose-500"]]);function rs(){var y;const s=h.useRef(null),t=h.useRef([]),[n,a]=h.useState([]),{translation:o}=E(),{data:{logLevel:l},set:c}=ae(),{general:{logLevel:r}}=le(),{t:d}=o("Logs"),m=Xe(),f=h.useRef(((y=s.current)==null?void 0:y.scrollHeight)??0),g=ft(r)==="silent";return h.useLayoutEffect(()=>{const u=s.current;u!=null&&f.current===u.scrollTop+u.clientHeight&&(u.scrollTop=u.scrollHeight-u.clientHeight),f.current=(u==null?void 0:u.scrollHeight)??0}),h.useEffect(()=>{function u(x){t.current=t.current.slice().concat(x.map(P=>({...P,time:new Date}))),a(t.current)}return m!=null&&(m.subscribe("data",u),t.current=m.buffer(),a(t.current)),()=>m==null?void 0:m.unsubscribe("data",u)},[m]),e.jsxs("div",{className:"page",children:[e.jsxs(B,{title:d("title"),children:[e.jsxs("span",{className:"mr-2 text-sm text-primary-darken",children:[d("levelLabel"),":"]}),e.jsx(Ye,{disabled:g,options:cs,value:g?"silent":l,onSelect:u=>c(x=>{x.logLevel=u})})]}),e.jsx(O,{className:"mt-2.5 flex flex-1 flex-col md:mt-4",children:e.jsx("ul",{className:"logs-panel",ref:s,children:n.map((u,x)=>e.jsxs("li",{className:"inline-block text-[11px] leading-5",children:[e.jsxs("span",{className:"mr-2 text-orange-400",children:["[",ee(u.time).format("YYYY-MM-DD HH:mm:ss"),"]"]}),e.jsxs("span",{className:is.get(u.type),children:["[",u.type.toUpperCase(),"]"]}),e.jsxs("span",{children:[" ",u.payload]})]},x))})})]})}var ge=(s=>(s.SPEED_NOTIFY="speed-notify",s))(ge||{});class ds{constructor(){this.EE=new Re}notifySpeedTest(){this.EE.emit("speed-notify")}subscribe(t,n){this.EE.addListener(t,n)}unsubscribe(t,n){this.EE.removeListener(t,n)}}const ve=new ds;const $e={"#909399":0,"#00c520":260,"#ff9a28":600,"#ff3e5e":1/0};function Ze(s){var x,P;const{config:t,className:n}=s,{set:a}=ce(),o=R(),l=h.useCallback(async p=>{if(J())return await(k==null?void 0:k.getProxyDelay(p))??0;const{data:{delay:N}}=await o.getProxyDelay(p);return N},[o]),c=h.useCallback(async function(){const p=await Ae.fromPromise(l(t.name),S=>S),N=p.isErr()?0:p.value;a(S=>{const b=S.proxies.find(L=>L.name===t.name);b!=null&&b.history.push({time:Date.now().toString(),delay:N})})},[t.name,l,a]),r=(x=t.history)!=null&&x.length?t.history.slice(-1)[0].delay:0,d=(P=t.history)!=null&&P.length?t.history.slice(-1)[0].meanDelay:void 0,m=r===0?"-":`${r}ms`,f=d?`(${d}ms)`:"";h.useLayoutEffect(()=>{const p=()=>{c()};return ve.subscribe(ge.SPEED_NOTIFY,p),()=>ve.unsubscribe(ge.SPEED_NOTIFY,p)},[c]);const g=h.useMemo(()=>r===0,[r]),y=h.useMemo(()=>Object.keys($e).find(p=>(d||r)<=$e[p]),[r,d]),u=g?"#E5E7EB":y;return e.jsxs("div",{className:w("proxy-item",{"opacity-50":g},n),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:w("rounded-sm py-[3px] px-1 text-[10px] text-white",{"text-gray-600":g}),style:{backgroundColor:u},children:t.type}),e.jsx("p",{className:"proxy-name",children:t.name})]}),e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-[10px] md:h-[18px] md:flex-row md:justify-between space-y-3 md:space-y-0",children:[e.jsxs("p",{children:[m,f]}),t.udp&&e.jsx("p",{className:"rounded bg-gray-200 p-[3px] text-gray-600",children:"UDP"})]})]})}function us(s){const{markProxySelected:t}=ce(),[n]=T(Ht),{data:a}=ae(),o=R(),{config:l}=s;async function c(m){if(await o.changeProxySelected(s.config.name,m),t(s.config.name,m),a.breakConnections){const f=[],g=await o.getConnections();for(const y of g.data.connections)y.chains.includes(s.config.name)&&f.push(y.id);await Promise.all(f.map(y=>o.closeConnection(y)))}}const r=h.useMemo(()=>{var f;const m=new Set;for(const g of l.all){const y=(f=n.get(g))==null?void 0:f.history;y!=null&&y.length&&y.slice(-1)[0].delay===0&&m.add(g)}return m},[l.all,n]),d=l.type==="Selector";return e.jsxs("div",{className:"proxy-group",children:[e.jsxs("div",{className:"mt-4 h-10 w-full flex items-center justify-between md:mt-0 md:h-15 md:w-auto",children:[e.jsx("span",{className:"overflow-ellipsis h-6 w-35 overflow-hidden whitespace-nowrap px-5 md:w-30",children:l.name}),e.jsx(se,{className:"mr-5 md:mr-0",children:l.type})]}),e.jsx("div",{className:"flex-1 py-2 md:py-4",children:e.jsx(Ft,{className:"ml-5 md:ml-8",data:l.all,onClick:c,errSet:r,select:l.now,canClick:d,rowHeight:30})})]})}function ms(s){const{update:t}=We(),{translation:n,lang:a}=E(),o=R(),{provider:l}=s,{t:c}=n("Proxies"),{visible:r,hide:d,show:m}=ie();function f(){m(),o.healthCheckProvider(l.name).then(async()=>await t()).finally(()=>d())}function g(){m(),o.updateProvider(l.name).then(async()=>await t()).finally(()=>d())}const y=h.useMemo(()=>l.proxies.slice().sort((u,x)=>-1*we(u,x)),[l.proxies]);return e.jsxs(O,{className:"proxy-provider",children:[e.jsx(Qe,{visible:r}),e.jsxs("div",{className:"flex flex-col justify-between md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-6",children:l.name}),e.jsx(se,{children:l.vehicleType})]}),e.jsxs("div",{className:"flex items-center pt-3 md:pt-0",children:[l.updatedAt&&e.jsx("span",{className:"text-sm",children:`${c("providerUpdateTime")}: ${ke(new Date(l.updatedAt),a)}`}),e.jsx($,{className:"cursor-pointer pl-5 text-red",type:"healthcheck",size:18,onClick:f}),e.jsx($,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:g})]})]}),e.jsx("ul",{className:"proxies-list",children:y.map(u=>e.jsx("li",{children:e.jsx(Ze,{className:"proxy-provider-item",config:u})},u.name))})]})}const hs={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function we(s,t){const n=s.history.length>0?s.history.slice(-1)[0].delay:0;return((t.history.length>0?t.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(n||Number.MAX_SAFE_INTEGER)}function fs(){const{groups:s,global:t}=ce(),{data:n,set:a}=ae(),{general:o}=le(),{translation:l}=E(),{t:c}=l("Proxies"),r=h.useMemo(()=>o.mode==="global"?[t,...s]:s,[o,s,t]);return e.jsx(e.Fragment,{children:r.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(B,{title:c("groupTitle"),children:e.jsx(Ke,{className:"cursor-pointer text-sm text-primary-600 text-shadow-primary",checked:n.breakConnections,onChange:d=>a("breakConnections",d),children:c("breakConnectionsText")})}),e.jsx(O,{className:"my-2.5 p-0 md:my-4",children:e.jsx("ul",{className:"list-none divide-y divide-gray-300",children:r.map(d=>e.jsx("li",{children:e.jsx(us,{config:d})},d.name))})})]})})}function xs(){const{providers:s}=We(),{translation:t}=E(),{t:n}=t("Proxies");return e.jsx(e.Fragment,{children:s.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(B,{title:n("providerTitle")}),e.jsx("ul",{className:"list-none",children:s.map(a=>e.jsx("li",{className:"my-2.5 md:my-4",children:e.jsx(ms,{provider:a})},a.name))})]})})}function ps(){const{proxies:s}=ce(),{translation:t}=E(),{t:n}=t("Proxies");function a(){ve.notifySpeedTest()}const{current:o,next:l}=Gt([1,2,0]),c=h.useMemo(()=>{switch(o){case 2:return s.slice().sort((d,m)=>we(d,m));case 1:return s.slice().sort((d,m)=>-1*we(d,m));default:return s.slice()}},[o,s]),r=l;return e.jsx(e.Fragment,{children:c.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(B,{title:n("title"),children:[e.jsx($,{className:"ml-3",type:hs[o],onClick:r,size:20}),e.jsx($,{className:"ml-3",type:"speed",size:20}),e.jsx("span",{className:"proxies-speed-test",onClick:a,children:n("speedTestText")})]}),e.jsx("ul",{className:"proxies-list",children:c.map(d=>e.jsx("li",{children:e.jsx(Ze,{config:d})},d.name))})]})})}function ys(){return e.jsxs("div",{className:"page",children:[e.jsx(fs,{}),e.jsx(xs,{}),e.jsx(ps,{})]})}function gs(s){const{update:t}=Ve(),{translation:n,lang:a}=E(),o=R(),{provider:l}=s,{t:c}=n("Rules"),{visible:r,hide:d,show:m}=ie();function f(){m(),o.updateRuleProvider(l.name).then(async()=>await t()).finally(()=>d())}const g=w("rule-provider-icon",{"rule-provider-loading":r});return e.jsx("div",{className:"rule-provider",children:e.jsxs("div",{className:"rule-provider-header",children:[e.jsxs("div",{className:"rule-provider-header-part",children:[e.jsx("span",{className:"rule-provider-name",children:l.name}),e.jsx(se,{children:l.vehicleType}),e.jsx(se,{className:"rule-provider-behavior",children:l.behavior}),e.jsx("span",{className:"rule-provider-update",children:`${c("ruleCount")}: ${l.ruleCount}`})]}),e.jsxs("div",{className:"rule-provider-header-part",children:[l.updatedAt&&e.jsx("span",{className:"rule-provider-update",children:`${c("providerUpdateTime")}: ${ke(new Date(l.updatedAt),a)}`}),e.jsx($,{className:g,type:"update",size:18,onClick:f})]})]})})}function vs(){const{providers:s}=Ve(),{translation:t}=E(),{t:n}=t("Rules");return e.jsx(e.Fragment,{children:s.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(B,{title:n("providerTitle")}),e.jsx(O,{className:"mt-4 rounded p-0 shadow-primary divide-y",children:s.map(a=>e.jsx(gs,{provider:a},a.name))})]})})}function ws(){const{rules:s,update:t}=Ot(),{translation:n}=E(),{t:a}=n("Rules");_("rules",t);function o({index:l,style:c}){const r=s[l];return e.jsx("li",{className:"rule-item",style:c,children:e.jsxs("div",{className:"flex py-1",children:[e.jsx("div",{className:"rule-type w-40 text-center",children:r.type}),e.jsx("div",{className:"payload flex-1 text-center",children:r.payload}),e.jsx("div",{className:"rule-proxy w-40 text-center",children:r.proxy})]})})}return e.jsxs("div",{className:"page",children:[e.jsx(vs,{}),e.jsx(B,{className:"not-first:mt-7.5",title:a("title")}),e.jsx(O,{className:"mt-2.5 flex flex-1 flex-col p-0 md:mt-4 focus:outline-none",children:e.jsx(xt,{className:"min-h-120",children:({height:l,width:c})=>e.jsx(pt,{height:l??0,width:c??0,itemCount:s.length,itemSize:50,children:o})})})]})}const js=[{label:"中文",value:"zh_CN"},{label:"English",value:"en_US"}];function bs(){const{premium:s}=Fe(),{data:t,update:n}=Je(),{general:a,update:o}=le(),l=Me(Se),[c,r]=T(Pe),d=q(Ce),m=Q(),{translation:f,setLang:g,lang:y}=E(),{t:u}=f("Settings"),x=R(),[P,p]=te({socks5ProxyPort:7891,httpProxyPort:7890,mixedProxyPort:0});h.useEffect(()=>{p("socks5ProxyPort",(a==null?void 0:a.socksPort)??0),p("httpProxyPort",(a==null?void 0:a.port)??0),p("mixedProxyPort",(a==null?void 0:a.mixedPort)??0)},[a,p]);async function N(i){await x.updateConfig({mode:i}),await o()}async function S(i){await(k==null?void 0:k.setStartAtLogin(i)),await n()}async function b(i){await(k==null?void 0:k.setSystemProxy(i)),await n()}function L(i){g(i)}async function W(){await x.updateConfig({port:P.httpProxyPort}),await o()}async function X(){await x.updateConfig({"socks-port":P.socks5ProxyPort}),await o()}async function Z(){await x.updateConfig({"mixed-port":P.mixedProxyPort}),await o()}async function re(i){await x.updateConfig({"allow-lan":i}),await o()}const{hostname:de,port:ue}=m,{allowLan:A,mode:U}=a,me=(t==null?void 0:t.startAtLogin)??!1,F=(t==null?void 0:t.systemProxy)??!1,D=(t==null?void 0:t.isClashX)??!1,he=h.useMemo(()=>{const i=[{label:u("values.global"),value:"Global"},{label:u("values.rules"),value:"Rule"},{label:u("values.direct"),value:"Direct"}];return s&&i.push({label:u("values.script"),value:"Script"}),i},[u,s]),fe=d.map((i,C)=>({value:C,label:e.jsx("span",{className:"truncate text-right",children:i.hostname})}));return D?`${de}${ue}`:(e.Fragment,d.length<2,w({"modify-btn":!D},"external-controller")),e.jsxs("div",{className:"page",children:[e.jsx(B,{title:u("title")}),e.jsxs(O,{className:"settings-card",children:[e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.startAtLogin")}),e.jsx(pe,{disabled:!(t!=null&&t.isClashX),checked:me,onChange:S})]}),e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.language")}),e.jsx(Te,{options:js,value:y,onSelect:i=>L(i)})]})]}),e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.setAsSystemProxy")}),e.jsx(pe,{disabled:!D,checked:F,onChange:b})]}),e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.allowConnectFromLan")}),e.jsx(pe,{checked:A,onChange:re})]})]})]}),e.jsxs(O,{className:"settings-card",children:[e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.proxyMode")}),e.jsx(Te,{options:he,value:yt(U),onSelect:N})]}),e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.socks5ProxyPort")}),e.jsx(G,{className:"w-28",disabled:D,value:P.socks5ProxyPort,onChange:i=>p("socks5ProxyPort",+i),onBlur:X})]})]}),e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.httpProxyPort")}),e.jsx(G,{className:"w-28",disabled:D,value:P.httpProxyPort,onChange:i=>p("httpProxyPort",+i),onBlur:W})]}),e.jsxs("div",{className:"w-full flex items-center justify-between px-8 py-3 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:u("labels.mixedProxyPort")}),e.jsx(G,{className:"w-28",disabled:D,value:P.mixedProxyPort,onChange:i=>p("mixedProxyPort",+i),onBlur:Z})]})]})]})]})}const Ns=""+new URL("logo-b453e72f.png",import.meta.url).href;function Cs(s){const{routes:t}=s,{translation:n}=E(),{version:a,premium:o}=Fe(),{data:l}=Je(),{t:c}=n("SideBar"),r=be(),d=t.map(({path:m,name:f,noMobile:g})=>e.jsx("li",{className:w("item",{"no-mobile":g}),children:e.jsx(gt,{to:{pathname:m,search:r.search},className:({isActive:y})=>w({active:y}),children:c(f)})},f));return e.jsxs("div",{className:"sidebar",children:[e.jsx("img",{src:Ns,alt:"logo",className:"sidebar-logo"}),e.jsx("ul",{className:"sidebar-menu",children:d}),e.jsxs("div",{className:"sidebar-version",children:[e.jsxs("span",{className:"sidebar-version-label",children:["Clash",(l==null?void 0:l.isClashX)&&"X"," ",c("Version")]}),e.jsx("span",{className:"sidebar-version-text",children:a}),o&&e.jsx("span",{className:"sidebar-version-label",children:"Premium"})]})]})}function Ps(){Xe();const s=be(),t=[{path:"/proxies",name:"Proxies",element:e.jsx(ys,{})},{path:"/logs",name:"Logs",element:e.jsx(rs,{})},{path:"/rules",name:"Rules",element:e.jsx(ws,{}),noMobile:!0},{path:"/connections",name:"Connections",element:e.jsx(as,{}),noMobile:!0},{path:"/settings",name:"Settings",element:e.jsx(bs,{})}],n=e.jsxs("div",{className:w("app",{"not-clashx":!J()}),children:[e.jsx(Cs,{routes:t}),e.jsx("div",{className:"page-container",children:e.jsx(vt,{})}),e.jsx(ls,{})]});return e.jsx(wt,{children:e.jsxs(xe,{path:"/",element:n,children:[e.jsx(xe,{path:"/",element:e.jsx(jt,{to:{pathname:"/proxies",search:s.search},replace:!0})}),t.map(a=>e.jsx(xe,{path:a.path,element:a.element},a.path))]})})}function Ie(){const s=document.getElementById("root"),t=e.jsx(h.StrictMode,{children:e.jsx(bt,{children:e.jsx(h.Suspense,{fallback:e.jsx(Qe,{visible:!0}),children:e.jsx(Ps,{})})})});He(s).render(t)}J()?Ct(()=>Ie()):Ie();
